/*! child-tracker-loader.js - v1.1.1 - 2016-10-12 */
!function(a,b){function c(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}var d=function(a){return a?a.autoInit():null},e=function(a){0!==this.el.getElementsByTagName("iframe").length&&this.sendMessage("on-screen",a)},f=function(a){0!==this.el.getElementsByTagName("iframe").length&&this.sendMessage("on-active",a)},g=function(){var a=location.hash;0!==this.el.getElementsByTagName("iframe").length&&this.sendMessage("visibility-available",a)},h=function(a){this.trackers[a].stopTracking(),delete this.trackers[a]},i=function(a,b){var c={};if(a){var d=new a.VisibilityTracker(this,b,e.bind(this,b),c);this.trackers[b]=d}else{var f=new window.ChildTracker.VisibilityTracker(this,b,e.bind(this,b),c);this.trackers[b]=f}},j=function(){var a=window.innerHeight||document.documentElement.clientHeight,b=this.iframe.getBoundingClientRect(),c=a/2-b.top,d={};for(var e in this.trackers){var g=this.trackers[e];console.log(g.rect,g.id);var h=Math.abs(g.rect.top-c),i=Math.abs(g.rect.bottom-c),j=Math.min(h,i);Object.keys(d).length?d.minValue>j&&(d.id=e,d.minValue=j):(d.id=e,d.minValue=j),console.log(e,j)}console.log(d.id,d.minValue),f.call(this,d.id)},k=c(j,70),l=function(a,b){for(var c=0;c<a.length;c++)!function(c){var d=a[c];d.trackers={},d.onMessage("test-visibility-tracker",g),d.onMessage("remove-tracker",h),d.onMessage("new-fact-check",i.bind(d,b)),addEventListener("scroll",k.bind(d))}(c)},m=function(b,c){if("undefined"!=typeof a){b=b.split(".js")[0],c=c.split(".js")[0];var e="context_debates_"+b.split("/").slice(-1)[0],f=a.config({context:e,paths:{pym:b,tracker:c},shim:{pym:{exports:"pym"},tracker:{exports:"tracker"}}});return f(["require","pym","tracker"],function(a,b,c){var e=d(b);e?l(e,c):console.error("did not find any pym instance on autoInit")}),!0}return!1},n=function(a,c){return"undefined"!=typeof b&&"function"==typeof b.getScript&&(b.getScript(a).done(function(){var a=d(window.pym);b.getScript(c).done(function(){l(a)})}),!0)},o=function(a,b){var c=document.getElementsByTagName("head")[0],e=document.createElement("script");return e.type="text/javascript",e.src=a,e.onload=function(){c&&e.parentNode&&c.removeChild(e);var a=d(window.pym);c=document.getElementsByTagName("head")[0];var f=document.createElement("script");f.type="text/javascript",f.src=b,f.onload=function(){c&&e.parentNode&&c.removeChild(e),l(a)},c.appendChild(f)},c.appendChild(e),!0},p="//pym.nprapps.org/pym.v1.min.js";0===p.lastIndexOf("@@",0)&&(p="../../src/pym.js");var q="//carebot.nprapps.org/child-tracker.v1.min.js";0===q.lastIndexOf("@@",0)&&(q="../../src/child-tracker.js"),m(p,q)||n(p,q)||o(p,q);var r=function(){document.removeEventListener("DOMContentLoaded",r),window.removeEventListener("load",r);var a=d(window.pym);return a&&"undefined"!=typeof ChildTracker&&l(a),a};window.document.addEventListener("DOMContentLoaded",r),window.addEventListener("load",r)}(window.requirejs,window.jQuery);