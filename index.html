<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <link rel="shortcut icon" href="http://media.npr.org/favicon.ico" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css">
        <link href="css/stylesheet.css" rel="stylesheet" type="text/css" media="screen">
        <link href="css/pygment_trac.css" rel="stylesheet" type="text/css" media="screen">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <title>Pym.js: Embed iframes responsively</title>
    </head>

    <body>
        <div id="container">

            <header>
                <div class="wrapper">
                    <h1>Pym.js</h1>
                    <h2>Embed iframes responsively</h2>
                    
                    <section class="clearfix">
                        <a href="https://github.com/nprapps/responsiveiframe/" id="view-on-github" class="button"><span>View on GitHub</span></a>
                        <div class="logos">
                            <a href="http://opennews.org" class="org-logo"><img src="img/opennews-logo.png"></a>
                            <!--<a href="http://opennews.org" class="org-logo"><img src="img/opennews-logo.png"></a>-->
                            <p><a href="http://opennews.org/code.html">Released for OpenNews Code Convening, April 2014</a></p>
                        </div>
                    </section>
                </div>
            </header>

            <div class="wrapper">
                <section id="about">
                    <h2>About Pym.js</h2>
                    <p>Using iframes in a responsive page can be tricky. It&rsquo;s easy enough to make an iframe&rsquo;s width span 100% of its container, but sizing its height is tricky &mdash; especially if the content of the iframe changes height depending on page width or actions within the iframe.</p>
                    <p>Pym.js embeds and resizes an iframe responsively (width <em>and</em> height) within its parent container. It also bypasses the usual cross-domain issues.</p>
                    <p><strong>Use case:</strong> The NPR Visuals team uses Pym.js to embed small custom bits of code (charts, maps, etc.) inside our CMS without CSS or JavaScript conflicts. <a href="http://www.npr.org/2014/03/25/293870089/maze-of-college-costs-and-aid-programs-trap-some-families">See an example of this in action.</a></p>
                </section>
                
                <section id="requirements">
                    <h3>Requirements/Assumptions</h3>
                    <ul>
                        <li>The responsive iframe library can stand alone and <em>does not require jQuery</em>. (Some of the examples use jQuery for unrelated features.)</li>
                        <li>If you&rsquo;re pasting the iframe embed code into a CMS or blogging software, make sure that it allows you to embed HTML and JavaScript. Some CMSes (such as WordPress) may strip it out.</li>
                        <li>The parent and child pages do not necessarily need to be on the same domain. (You can restrict this with xdomain.)</li>
                    </ul>
                </section>
                    
                <section id="examples">
                    <h3>Usage</h3>
                    <p>Resize your browser window to see the responsiveness in action. Replace "<strong>PATH-TO-THIS-FOLDER</strong>" with the actual published path to your files</p>
                    
                    <div class="example-block">
                        <h4>On the Parent Page (Where You're Putting the iFrame)</h4>
                        <ul>
                            <li>Name your containing div with a unique ID name, and include a <code>data-iframe-target</code> attribute with the path to your <code>child.html</code> file.</li>
                            <li>Include <code>responsiveIframe.js</code>. <em>Only once per page.</em></li>
                            <li>Call <code>window.responsiveParent();</code> to set up all responsive iframes on the page. <em>Only once per page.</em></li>
                            <li>You can optionally pass in a regex to filter incoming message domains: <code>$('iframe').responsiveIframe({ xdomain: '*\.npr\.org' });</code></li>
                        </ul>

<pre><code>&lt;div id="example" data-iframe-target="PATH-TO-THIS-FOLDER/child.html"&gt;&lt;/div&gt;
&lt;script type="text/javascript" src="PATH-TO-THIS-FOLDER/responsiveIframe.js"&gt;&lt;/script&gt;
&lt;script&gt;window.responsiveParent();&lt;/script&gt;
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>On the Child Page (The Content You Want to Embed)</h4>
                        <ul>
                            <li>Include <code>child.js</code>.</li>
                            <li>Invoke <code>setupResponsiveChild();</code>.</li>
                            <li>If the contents of your iframe are dynamic you will want to pass in a rendering function, like this: <code>setupResponsiveChild({ renderCallback: myFunc });</code> This function will be called once on load and then again anytime the window is resized.</li>
                            <li>You can optionally pass in a number of milliseconds to enable automaticaly updating the height at that rate (in addition to on load and resize events). Like this <code>setupResponsiveChild({ polling: 500 });</code>.</li>
                        </ul>
                    </div>


                    <div class="example-block">
                        <h4>Example: Basic Embed</h4>
                        <p>In our simplest example, we have an HTML table that changes format (via CSS media queries). The height of the iframe adjusts to the height of the content onload and onresize.</p>

                        <div id="example-table" class="example" data-iframe-target="examples/table/child.html"></div>
                        
                        <h5>Code Needed on the Child Page</h5>
<pre><code>&lt;script src="PATH-TO-THIS-FOLDER/responsiveIframe.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script&gt;window.responsiveChild();&lt;/script&gt;
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Example: Call a Function When the Page Resizes</h4>
                        <p>This might be useful in cases where sections of your child page need to be redrawn based on the new width. (For example, a graphic generated by D3, which would not stretch or reflow on its own.)</p>

                        <div id="example-graphic" class="example" data-iframe-target="examples/graphic/child.html"></div>
                        
                        <h5>Code Needed on the Child Page</h5>
<pre><code>&lt;script src="PATH-TO-THIS-FOLDER/responsiveIframe.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script&gt;
function drawGraphic(width) {
...
}
window.responsiveChild({renderCallback: drawGraphic});
&lt;/script&gt;
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Example: Manual resize events</h4>
                        <p>If you have dynamic content and need finer control over resize events, you can invoke <code>sendHeightToParent()</code> in the child window at any time to force the iframe to update its size. For example, say you have a quiz, and the content of the page changes when someone selects an answer, affecting the page&rsquo;s height:</p>

                        <div id="example-quiz" class="example" data-iframe-target="examples/quiz/child.html"></div>
                        
                        <h5>Code Needed on the Child Page</h5>
<pre><code>&lt;script src="PATH-TO-THIS-FOLDER/responsiveIframe.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script&gt;
function check_answer(e) {
    // highlight the correct answer
    window.responsiveChild.sendHeightToParent();
}
$('.question').find('li').on('click', check_answer);
window.responsiveChild();
&lt;/script&gt;
</code></pre>
                    </div>
                </section>
                
                
                <section id="how">
                    <h3>How It Works</h3>
                    <p>The <code>parent.js</code> library and a small bit of javascript are injected onto the parent page. This code writes an iframe to the page in a container of your choice. The request for the iframe's contents includes querystring parameters for the <code>initialWidth</code> and <code>childId</code> of the child page. The initialWidth allows the child to know its size immediately on load. (In iOS the child frame can not determine its own width accurately.) The <code>childId</code> allows multiple children to be embedded on the same page, each with its own communication to the parent.</p>
                    <p>The child page includes <code>child.js</code> and its own javascript. It invokes the <code>setupResponsiveIframe</code> function, which initializes cross-iframe communication to the parent, renders the any dynamic contents and then sends the computed height of the child to the parent via <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">postMessage</a>. Upon receiving this message the parent resizes the containing iframe, thus ensuring the contents of the child are always visible.</p>
                    <p>The parent page also registers for resize events. Any time one is received, the parent sends the new container width to each child via <code>postMessage</code>. The child rerenders its content and sends back the new height.</p>
                </section>


                <section id="license">
                    <h3>License</h3>
                    <p><a href="https://github.com/nprapps/responsiveiframe/blob/master/LICENSE">MIT</a></p>
                </section>

                <footer>
                    <p>Pym.js was built by the <a href="http://github.com/nprapps">NPR Visuals</a> team, based on work by the <a href="https://github.com/npr/responsiveiframe">NPR Tech Team</a> and <a href="https://github.com/ioseb">Ioseb Dzmanashvili</a>. Thanks to <a href="https://twitter.com/erikhinton">Erik Hinton</a> for suggesting the name.</p>
                </footer>
            </div>
        </div>

    <script type="text/javascript" src="src/responsiveIframe.js"></script>
    <script>window.responsiveParent();</script>

    </body>
</html>