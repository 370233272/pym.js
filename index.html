<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
        <link rel="shortcut icon" href="http://media.npr.org/favicon.ico" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css">
        <link href="css/stylesheet.css" rel="stylesheet" type="text/css" media="screen">
        <link href="css/pygment_trac.css" rel="stylesheet" type="text/css" media="screen">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <title>Pym.js: Embed iframes responsively</title>
    </head>

    <body>
        <div id="container">

            <header>
                <div class="wrapper">
                    <h1>Pym.js</h1>
                    <h2>Embed iframes responsively</h2>

                    <section class="clearfix">
                        <a href="https://github.com/nprapps/responsiveiframe/" id="view-on-github" class="button"><span>View on GitHub</span></a>
                        <a href="./api/" id="api" class="button"><span>Browse API docs</span></a>
                        <div class="logos">
                            <a href="http://opennews.org" class="org-logo"><img src="img/opennews-logo.png"></a>
                            <a href="http://blog.apps.npr.org" class="org-logo npr"><img src="http://media.npr.org/chrome/news/nprlogo_138x46.gif"></a>
                            <p><a href="http://opennews.org/code.html">Released for OpenNews Code Convening, April 2014</a></p>
                        </div>
                    </section>
                </div>
            </header>

            <div class="wrapper">
                <section id="about">
                    <h2>About Pym.js</h2>
                    <p>Using iframes in a responsive page can be frustrating. It&rsquo;s easy enough to make an iframe&rsquo;s width span 100% of its container, but sizing its height is tricky &mdash; especially if the content of the iframe changes height depending on page width (for example, because of text wrapping or media queries) or events within the iframe.</p>
                    <p><a href="https://raw.githubusercontent.com/nprapps/responsiveiframe/master/src/pym.js">Pym.js</a> embeds and resizes an iframe responsively (width <em>and</em> height) within its parent container. It also bypasses the usual cross-domain issues.</p>
                    <p><strong>Use case:</strong> The NPR Visuals team uses Pym.js to embed small custom bits of code (charts, maps, etc.) inside our CMS without CSS or JavaScript conflicts. <a href="http://www.npr.org/2014/03/25/293870089/maze-of-college-costs-and-aid-programs-trap-some-families">See an example of this in action.</a></p>
                </section>

                <section id="requirements">
                    <h3>Requirements/Assumptions</h3>
                    <ul>
                        <li><code>pym.js</code> does not require jQuery or any other libraries. Some of the examples use jQuery on the child pages for unrelated features.</li>
                        <li>If you&rsquo;re pasting the iframe embed code into a CMS or blogging software, make sure that it allows you to embed HTML and JavaScript. Some CMSes (such as WordPress) may strip tags out.</li>
                        <li>The parent and child pages do not need to be on the same domain. If they are not, child URLs should be fully-qualified, e.g., <code>http://blog.apps.npr.org/pym.js/examples/graphic/child.html</code></li>
                        <li><code>pym.js</code> isn't built to handle embedding more than a handful of child frames on the parent. Ten or fewer is a good rule of thumb.</li>
                    </ul>

                    <h3>Browsers</h3>
                    <p><code>pym.js</code> has been tested in:</p>
                    <ul>
                        <li>Internet Explorer 9, 10 (Windows 7), 11 (Windows 8)</li>
                        <li>Chrome 32 (Mac 10.9)</li>
                        <li>Firefox 26 (Mac 10.9)</li>
                        <li>Safari 7 (Mac 10.9)</li>
                        <li>iOS 7 Safari</li>
                        <li>iOS 7 Chrome</li>
                        <li>Android 4.4 Chrome</li>
                    </ul>
                    <p>Internet Explorer versions earlier than 9 are not supported.</p>
                </section>

                <section id="install">
                    <h3>Installing with Bower</h3>
                    <p>If you use <a href="http://bower.io/">Bower</a> to manage your Javascript dependencies then you can install Pym.js by running:</p>

                    <p><code>bower install pym.js</code></p>

                    <p>Otherwise you can just copy <code>pym.js</code> into your codebase like you would any other javascript library.</p>
                </section>

                <section id="examples">
                    <h3>Usage</h3>
                    <p>Resize your browser window to see the responsiveness in action.</p>

                    <div class="example-block">
                        <h4>On the Parent Page (Where You&rsquo;re Putting the iFrame)</h4>
                        <ul>
                            <li>Name your containing div with a unique ID.</li>
                            <li>Include <code>pym.js</code>. <em>Only once per page.</em></li>
                            <li>Create a <code>new pym.Parent(parent_id, child_url);</code> for <em>each</em> responsive iframe.</li>
                            <li>Optional: To filter incoming message domains, you can pass in a regex. For example: <code>pym.Parent('example', 'child.html', { xdomain: '*\.npr\.org' });</code></li>
                        </ul>

<pre><code>&lt;div id="example"&gt;&lt;/div&gt;
&lt;script type="text/javascript" src="pym.js"&gt;&lt;/script&gt;
&lt;script&gt;
    var pymParent = new pym.Parent('example', 'child.html', {});
&lt;/script&gt;
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Multiple Embeds on the Same Parent Page</h4>
                        <p>You don&rsquo;t have to do anything special to the child pages, but you do need to keep a few things in mind for the parent page:</p>
                        <ul>
                            <li>Each child embed needs a unique div ID (<code>&lt;div id="example"&gt;</code>, <code>&lt;div id="bar-graph"&gt;</code>, etc.).</li>
                            <li>Include <code>pym.js</code> only <em>once</em> on the page.</li>
                        </ul>

                        <h5>HTML Needed on the Parent Page</h5>
<pre><code>&lt;div id="example-1"&gt;&lt;/div&gt;
&lt;div id="example-2"&gt;&lt;/div&gt;
</code></pre>

                        <h5>Javascript Needed on the Parent Page</h5>
<pre><code>var pymParent = new pym.Parent('example-1', 'child-1.html', {});
var second = new pym.Parent('example-2', 'child-2.html', {});
</code></pre>

                    </div>


                    <div class="example-block">
                        <h4>On the Child Page (The Content You Want to Embed)</h4>
                        <ul>
                            <li>Include <code>pym.js</code>.</li>
                            <li>Create a <code>new pym.Child();</code>.</li>
                            <li>Optional: If the contents of your iframe are dynamic you will want to pass in a rendering function, like this: <code>pym.Child({ renderCallback: myFunc });</code> This function will be called once when the page loads and again any time the window is resized.</li>
                            <li>Optional: You can pass in a number of milliseconds to enable automaticaly updating the height at that rate (in addition to onload and onresize events). For example: <code>pym.Child({ polling: 500 });</code>.</li>
                            <li>Optional: If you need finer control over resize events, you can invoke <code>pymChild.sendHeight()</code> at any time to force the iframe to update its size.</li>
                        </ul>
                    </div>


                    <div class="example-block">
                        <h4>Example: Basic Embed</h4>
                        <p>In our simplest example, we have an HTML table that changes format (via CSS media queries). The height of the iframe adjusts to the height of the content onload and onresize.</p>

                        <div id="example-table" class="example"></div>

                        <h5>Javascript Needed on the Child Page</h5>
<pre><code>var pymChild = new pym.Child();
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Example: Call a Function When the Page Resizes</h4>
                        <p>This might be useful in cases where sections of your child page need to be redrawn based on the new width. (For example, a graphic generated by D3, which would not stretch or reflow on its own.)</p>

                        <div id="example-graphic" class="example"></div>

                        <h5>Javascript Needed on the Child Page</h5>
<pre><code>function drawGraphic(width) {
    ...
}

var pymChild = new pym.Child({ renderCallback: drawGraphic });
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Example: Manual resize events</h4>
                        <p>If you have dynamic content and need finer control over resize events, you can invoke <code>pymChild.sendHeight()</code> in the child window at any time to force the iframe to update its size. For example, say you have a quiz, and the content of the page changes when someone selects an answer, affecting the page&rsquo;s height:</p>

                        <div id="example-quiz" class="example"></div>

                        <h5>Javascript Needed on the Child Page</h5>

<pre><code>function check_answer(e) {
    // highlight the correct answer
    ...

    // send updated height to parent
    pymChild.sendHeight();
}

$('.question').find('li').on('click', check_answer);

var pymChild = new pym.Child();
</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Example: Resizing after following links in the iframe</h4>
                        <p>If you have links in your iframe that lead to other pages, you can maintain auto-resizing on the subsequent pages by explicitly setting the child ID in each one.</p>

                        <div id="example-follow-links" class="example"></div>

                        <h5>Javascript Needed on Every Child Page</h5>
                        <pre><code>var pymChild = new pym.Child({id: "example-follow-links"});
                        </code></pre>
                        
                    </div>

                </section>

                <section id="how">
                    <h3>How It Works</h3>
                    <p>The <code>Pym.js</code> library and a small bit of javascript are injected onto the parent page. This code writes an iframe to the page in a container of your choice. The request for the iframe&rsquo;s contents includes querystring parameters for the <code>initialWidth</code> and <code>childId</code> of the child page. The <code>initialWidth</code> allows the child to know its size immediately on load, because in iOS, the child frame can not determine its own width accurately. The <code>childId</code> allows multiple children to be embedded on the same page, each with its own communication to the parent.</p>
                    <p>The child page also includes <code>Pym.js</code> and its own javascript. It initializes cross-iframe communication to the parent, renders any dynamic content and then sends the computed height of the child to the parent via <code>postMessage</code>. Upon receiving this message the parent resizes the containing iframe, thus ensuring the contents of the child are always visible.</p>
                    <p>The parent page also registers for resize events. Any time one is received, the parent sends the new container width to each child via <code>postMessage</code>. The child re-renders its content and sends back the new height.</p>
                </section>

                <section id="auto">
                    <h3>Auto-initializing Pym</h3>

                    <p>Certain CMS's prevent custom Javascript from being embedded on the page. In order to allow pym to support those environments, it can be initialized via <code>data-</code> attributes. This limits usage of pym to simple cases, but should still be enough for many users.</p>

                    <h5>HTML Needed on the Parent Page</h5>

<pre><code>&lt;div data-pym-src="child.html"&gt;&lt;/div&gt;
</code></pre>
                </section>

                <section id="custom-events">
                    <h3>Sending Custom iFrame Events</h3>

                    <p>Although not its original purpose, pym.js can also be used to send and receive generic event data between the iframe parent and child. A simple, jQuery-like event binding model is used to support this message passing.</p> 

                    <p>In the following example a click on the link in the parent container will navigate the child frame to a new location.</p>

                    <h5>Javascript Needed on the Parent Page</h5>
<pre><code>var pymParent = pym.Parent('example', 'child.html', {});

document.getElementById('myLink').addEventListener('click', onLinkClick);

function onLinkClick(e) {
    e.preventDefault();

    pymParent.sendMessage('navigate', e.target.href);
}
</code></pre>

                    <h5>Javascript needed on the Child page</h5>
<pre><code>var pymChild = new pym.Child();

pymChild.onMessage('navigate', onNavigateMessage);

function onNavigateMessage(url) {
    window.location.href = url;
}
</code></pre>

                    <p>Note that the reverse scenario can be performed as well; children can send messages to the parent with the same <code>sendMessage()</code> function.</p>
                </section>

                <section id="in-the-wild">
                    <h3>Pym.js in the wild</h3>

                    <ul>
                        <li><a href="http://time.com/58386/happiest-facebook-friends/">Time</a> used it to get around cross-domain issues.</li>
                        <li><a href="http://www.texastribune.org/2014/05/11/tim-dunn-far-right-has-big-spender-who-gets-result/">Texas Tribune</a> used it to to embed responsive tables.</a></li>
                        <li><a href="http://www.pbs.org/newshour/updates/country-comes-parenting-values/">PBS Newshour</a> made a responsive survey.</li>
                        <li><a href="http://nerds.investigativenewsnetwork.org/discounts/">Investigative News Network</a> created responsive tables and a <a href="https://github.com/INN/responsive-tables">framework</a> for making them quickly.
                        <li><a href="http://fivethirtyeight.com/interactives/pollster-ratings/">538</a> rated pollsters in a responsive table</li>
                        <li><a href="http://www.kunc.org/post/watch-greeley-get-surrounded-15000-oil-wells-13-years">KUNC</a> used it to embed animated GIFs and small chunks of code in their CorePublisher site</li>
                    </ul>

                </section>

                <section id="license">
                    <h3>License</h3>
                    <p><a href="https://github.com/nprapps/responsiveiframe/blob/master/LICENSE">MIT</a></p>
                </section>

                <footer>
                    <p>Pym.js was built by the <a href="http://github.com/nprapps">NPR Visuals</a> team, based on work by the <a href="https://github.com/npr/responsiveiframe">NPR Tech Team</a> and <a href="https://github.com/ioseb">Ioseb Dzmanashvili</a>. Thanks to <a href="https://twitter.com/erikhinton">Erik Hinton</a> for suggesting the name.</p>
                </footer>
            </div>
        </div>

    <script type="text/javascript" src="src/pym.js"></script>
    <script>
        new pym.Parent('example-table', 'examples/table/child.html', {});
        new pym.Parent('example-graphic', 'examples/graphic/child.html', {});
        new pym.Parent('example-quiz', 'examples/quiz/child.html', {});
        new pym.Parent('example-follow-links', 'examples/follow-links/child.html', {});
    </script>

    </body>
</html>
